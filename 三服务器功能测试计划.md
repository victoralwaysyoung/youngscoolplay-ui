# YoungsCoolPlay UI 三服务器功能测试计划

## 测试概述

本文档详细描述了YoungsCoolPlay UI在三服务器环境下的功能测试计划，包括单服务器测试、多服务器协同测试、负载均衡测试和故障切换测试。

**部署方式**: 通过GitHub远程拉取源代码并编译部署

## 测试环境规划

### 服务器配置
- **服务器A (主服务器)**: Ubuntu 24.04 LTS, 4GB RAM, 2 CPU cores
- **服务器B (备用服务器)**: Ubuntu 24.04 LTS, 4GB RAM, 2 CPU cores  
- **服务器C (负载均衡器)**: Ubuntu 24.04 LTS, 2GB RAM, 1 CPU core

### 环境依赖要求
- **Git**: 版本 >= 2.25.0
- **Go**: 版本 >= 1.21.0
- **系统**: Ubuntu 24.04 LTS (推荐)
- **网络**: 能够访问GitHub (github.com)

### 网络配置
- **服务器A IP**: 192.168.1.10
- **服务器B IP**: 192.168.1.11
- **服务器C IP**: 192.168.1.12 (负载均衡器)
- **虚拟IP (VIP)**: 192.168.1.100

### 端口配置
- **Web管理面板**: 2053
- **代理服务**: 10000-10010
- **健康检查**: 8080
- **负载均衡器**: 80, 443

## 环境准备阶段

### 0.1 系统环境配置
**目标**: 确保所有服务器具备必要的开发和运行环境

**在每台服务器上执行**:
```bash
# 更新系统包
sudo apt update && sudo apt upgrade -y

# 安装基础工具
sudo apt install -y curl wget unzip git build-essential

# 安装Go环境 (版本1.21+)
wget https://go.dev/dl/go1.21.5.linux-amd64.tar.gz
sudo rm -rf /usr/local/go
sudo tar -C /usr/local -xzf go1.21.5.linux-amd64.tar.gz
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
echo 'export GOPATH=$HOME/go' >> ~/.bashrc
echo 'export GOBIN=$GOPATH/bin' >> ~/.bashrc
source ~/.bashrc

# 验证安装
go version
git --version
```

### 0.2 GitHub访问配置
**目标**: 确保能够正常访问GitHub并克隆代码

**测试GitHub连接**:
```bash
# 测试GitHub连接
ping -c 3 github.com
curl -I https://github.com

# 配置Git (如需要)
git config --global user.name "Test User"
git config --global user.email "test@example.com"
```

## 第一阶段：单服务器功能测试

### 1.1 源代码获取和编译测试
**目标**: 从GitHub获取源代码并成功编译

**测试步骤**:
1. 克隆项目源代码
   ```bash
   # 克隆项目到服务器
   cd /opt
   sudo git clone https://github.com/victoralwaysyoung/youngscoolplay-ui.git
   sudo chown -R $USER:$USER youngscoolplay
   cd youngscoolplay
   ```

2. 检查项目结构和依赖
   ```bash
   # 查看项目结构
   ls -la
   
   # 检查Go模块
   go mod tidy
   go mod download
   
   # 验证依赖完整性
   go mod verify
   ```

3. 编译项目
   ```bash
   # 编译Linux版本
   CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -ldflags="-s -w" -o youngscoolplay-ui
   
   # 验证编译结果
   ls -lh youngscoolplay-ui
   file youngscoolplay-ui
   ```

4. 安装和配置
   ```bash
   # 创建系统用户和目录
   sudo useradd --system --shell /bin/false youngscoolplay
   sudo mkdir -p /etc/youngscoolplay-ui
   sudo mkdir -p /var/log/youngscoolplay-ui
   sudo mkdir -p /var/lib/youngscoolplay-ui
   
   # 复制文件
   sudo cp youngscoolplay-ui /usr/local/bin/
   sudo chmod +x /usr/local/bin/youngscoolplay-ui
   sudo cp -r web /var/lib/youngscoolplay-ui/
   sudo cp -r bin /var/lib/youngscoolplay-ui/
   
   # 创建配置文件
   sudo tee /etc/youngscoolplay-ui/config.json > /dev/null << 'EOF'
   {
     "listen": "0.0.0.0",
     "port": 2053,
     "webBasePath": "/",
     "webCertFile": "",
     "webKeyFile": "",
     "webListen": "",
     "webPort": 2053,
     "webPath": "/var/lib/youngscoolplay-ui/web",
     "sessionMaxAge": 60,
     "pageSize": 50,
     "expireDiff": 0,
     "tgBotEnable": false,
     "tgBotToken": "",
     "tgBotChatId": "",
     "tgRunTime": "@daily",
     "timeLocation": "Asia/Shanghai"
   }
   EOF
   
   # 创建systemd服务文件
   sudo tee /etc/systemd/system/youngscoolplay-ui.service > /dev/null << 'EOF'
   [Unit]
   Description=YoungsCoolPlay UI Service
   After=network.target
   Wants=network.target
   
   [Service]
   Type=simple
   User=youngscoolplay
   Group=youngscoolplay
   ExecStart=/usr/local/bin/youngscoolplay-ui -config /etc/youngscoolplay-ui/config.json
   Restart=on-failure
   RestartSec=5s
   StandardOutput=journal
   StandardError=journal
   SyslogIdentifier=youngscoolplay-ui
   KillMode=mixed
   KillSignal=SIGINT
   TimeoutStopSec=5s
   
   [Install]
   WantedBy=multi-user.target
   EOF
   
   # 设置权限
   sudo chown -R youngscoolplay:youngscoolplay /etc/youngscoolplay-ui
   sudo chown -R youngscoolplay:youngscoolplay /var/log/youngscoolplay-ui
   sudo chown -R youngscoolplay:youngscoolplay /var/lib/youngscoolplay-ui
   
   # 启动服务
   sudo systemctl daemon-reload
   sudo systemctl enable youngscoolplay-ui
   sudo systemctl start youngscoolplay-ui
   ```

**预期结果**:
- 源代码成功克隆
- 编译无错误，生成可执行文件
- 服务成功启动
- 端口2053正常监听
- systemd服务状态为active

**验证命令**:
```bash
# 检查编译结果
ls -lh youngscoolplay-ui

# 检查服务状态
sudo systemctl status youngscoolplay-ui

# 检查端口监听
sudo netstat -tuln | grep 2053

# 检查Web访问
curl -I http://localhost:2053

# 检查日志
sudo journalctl -u youngscoolplay-ui -f --no-pager -n 20
```

### 1.2 基础功能测试
**目标**: 验证核心功能正常工作

**测试项目**:
1. **Web界面访问**
   - 访问 http://192.168.1.10:2053
   - 验证登录页面正常显示
   - 使用默认账号登录 (admin/admin)

2. **配置管理**
   - 创建新的代理配置
   - 修改现有配置
   - 删除配置
   - 导入/导出配置

3. **服务控制**
   - 启动代理服务
   - 停止代理服务
   - 重启代理服务
   - 查看服务状态

4. **日志功能**
   - 查看实时日志
   - 下载日志文件
   - 日志轮转测试

**验证标准**:
- 所有操作响应时间 < 3秒
- 无JavaScript错误
- 配置保存成功
- 日志记录完整

### 1.3 性能基准测试
**目标**: 建立单服务器性能基准

**测试指标**:
- CPU使用率
- 内存使用率
- 网络吞吐量
- 并发连接数

**测试工具**:
```bash
# 系统监控
htop
iotop
nethogs

# 网络测试
iperf3 -s  # 服务器端
iperf3 -c 192.168.1.10 -t 60  # 客户端测试

# 并发测试
ab -n 1000 -c 10 http://192.168.1.10:2053/
```

## 第二阶段：双服务器协同测试

### 2.1 主备服务器部署
**目标**: 在服务器A和B上部署相同配置

**部署步骤**:
1. 在服务器B上重复第一阶段的源代码获取和编译过程
   ```bash
   # 在服务器B上执行相同的克隆和编译步骤
   cd /opt
   sudo git clone https://github.com/victoralwaysyoung/youngscoolplay-ui.git
   sudo chown -R $USER:$USER youngscoolplay
   cd youngscoolplay
   
   # 编译和安装 (重复1.1节的步骤3-4)
   CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -ldflags="-s -w" -o youngscoolplay-ui
   # ... 执行完整的安装配置过程
   ```

2. 同步配置文件
   ```bash
   # 在服务器A上备份配置
   sudo tar -czf config-backup.tar.gz -C /etc/youngscoolplay-ui .
   scp config-backup.tar.gz user@192.168.1.11:/tmp/
   
   # 在服务器B上应用配置
   sudo systemctl stop youngscoolplay-ui
   sudo tar -xzf /tmp/config-backup.tar.gz -C /etc/youngscoolplay-ui
   sudo chown -R youngscoolplay:youngscoolplay /etc/youngscoolplay-ui
   sudo systemctl start youngscoolplay-ui
   ```

3. 验证配置同步
   ```bash
   # 比较配置文件
   diff <(ssh user@192.168.1.10 'sudo cat /etc/youngscoolplay-ui/config.json') \
        <(ssh user@192.168.1.11 'sudo cat /etc/youngscoolplay-ui/config.json')
   
   # 验证服务状态
   ssh user@192.168.1.10 'sudo systemctl status youngscoolplay-ui'
   ssh user@192.168.1.11 'sudo systemctl status youngscoolplay-ui'
   ```

4. 创建部署脚本 (可选)
   ```bash
   # 创建自动化部署脚本
   cat > deploy-from-github.sh << 'EOF'
   #!/bin/bash
   
   REPO_URL="https://github.com/victoralwaysyoung/youngscoolplay-ui.git"
   INSTALL_DIR="/opt/youngscoolplay"
   SERVICE_NAME="youngscoolplay-ui"
   
   echo "开始从GitHub部署YoungsCoolPlay UI..."
   
   # 停止现有服务
   sudo systemctl stop $SERVICE_NAME 2>/dev/null || true
   
   # 备份现有配置
   if [ -d "/etc/$SERVICE_NAME" ]; then
       sudo cp -r /etc/$SERVICE_NAME /tmp/${SERVICE_NAME}-config-backup-$(date +%Y%m%d-%H%M%S)
   fi
   
   # 更新源代码
   if [ -d "$INSTALL_DIR" ]; then
       cd $INSTALL_DIR
       sudo git pull origin main
   else
       cd /opt
       sudo git clone $REPO_URL youngscoolplay
       sudo chown -R $USER:$USER youngscoolplay
   fi
   
   cd $INSTALL_DIR
   
   # 编译项目
   echo "编译项目..."
   CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -ldflags="-s -w" -o youngscoolplay-ui
   
   # 安装二进制文件
   sudo cp youngscoolplay-ui /usr/local/bin/
   sudo chmod +x /usr/local/bin/youngscoolplay-ui
   
   # 更新Web资源
   sudo cp -r web /var/lib/youngscoolplay-ui/
   sudo cp -r bin /var/lib/youngscoolplay-ui/ 2>/dev/null || true
   sudo chown -R youngscoolplay:youngscoolplay /var/lib/youngscoolplay-ui
   
   # 重启服务
   sudo systemctl daemon-reload
   sudo systemctl start $SERVICE_NAME
   sudo systemctl enable $SERVICE_NAME
   
   echo "部署完成！"
   echo "服务状态: $(sudo systemctl is-active $SERVICE_NAME)"
   EOF
   
   chmod +x deploy-from-github.sh
   ```

### 2.2 数据同步测试
**目标**: 验证配置和数据在两台服务器间的同步

**测试场景**:
1. **配置同步**
   - 在服务器A修改配置
   - 验证服务器B是否同步更新
   - 测试双向同步

2. **用户数据同步**
   - 创建新用户账号
   - 修改用户权限
   - 删除用户账号

3. **统计数据同步**
   - 流量统计
   - 连接记录
   - 错误日志

**同步机制测试**:
```bash
# 创建同步脚本
cat > /usr/local/bin/sync-config.sh << 'EOF'
#!/bin/bash
rsync -avz --delete /etc/youngscoolplay-ui/ user@192.168.1.11:/etc/youngscoolplay-ui/
ssh user@192.168.1.11 'sudo systemctl reload youngscoolplay-ui'
EOF

chmod +x /usr/local/bin/sync-config.sh
```

### 2.3 故障切换测试
**目标**: 验证主服务器故障时的自动切换

**测试步骤**:
1. **模拟服务器A故障**
   ```bash
   # 停止服务器A的服务
   sudo systemctl stop youngscoolplay-ui
   ```

2. **验证服务器B接管**
   - 检查服务器B状态
   - 验证客户端连接转移
   - 测试功能完整性

3. **恢复测试**
   ```bash
   # 重启服务器A
   sudo systemctl start youngscoolplay-ui
   ```

4. **双活测试**
   - 同时运行两台服务器
   - 测试负载分担
   - 验证数据一致性

## 第三阶段：三服务器负载均衡测试

### 3.1 负载均衡器配置
**目标**: 在服务器C上配置Nginx负载均衡

**Nginx配置**:
```nginx
upstream youngscoolplay_backend {
    server 192.168.1.10:2053 weight=3 max_fails=3 fail_timeout=30s;
    server 192.168.1.11:2053 weight=3 max_fails=3 fail_timeout=30s;
    
    # 健康检查
    keepalive 32;
}

server {
    listen 80;
    server_name youngscoolplay.local;
    
    location / {
        proxy_pass http://youngscoolplay_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 健康检查
        proxy_connect_timeout 5s;
        proxy_send_timeout 10s;
        proxy_read_timeout 10s;
    }
    
    # 健康检查端点
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
```

### 3.2 负载均衡算法测试
**目标**: 测试不同负载均衡算法的效果

**测试算法**:
1. **轮询 (Round Robin)**
2. **加权轮询 (Weighted Round Robin)**
3. **最少连接 (Least Connections)**
4. **IP哈希 (IP Hash)**

**测试脚本**:
```bash
#!/bin/bash
# 负载均衡测试脚本

echo "开始负载均衡测试..."

# 测试轮询算法
for i in {1..10}; do
    response=$(curl -s -w "%{http_code}" http://192.168.1.12/ -o /dev/null)
    echo "请求 $i: HTTP $response"
    sleep 1
done

# 并发测试
ab -n 1000 -c 50 http://192.168.1.12/

# 检查后端服务器负载
echo "服务器A负载:"
ssh user@192.168.1.10 'uptime && free -h'

echo "服务器B负载:"
ssh user@192.168.1.11 'uptime && free -h'
```

### 3.3 高可用性测试
**目标**: 验证系统在各种故障场景下的可用性

**故障场景**:
1. **单台后端服务器故障**
   - 停止服务器A
   - 验证流量自动转移到服务器B
   - 检查用户体验影响

2. **负载均衡器故障**
   - 停止Nginx服务
   - 测试直接访问后端服务器
   - 验证故障恢复时间

3. **网络分区测试**
   - 模拟网络中断
   - 测试服务降级
   - 验证数据一致性

**故障注入脚本**:
```bash
#!/bin/bash
# 故障注入测试脚本

# 随机停止一台服务器
servers=("192.168.1.10" "192.168.1.11")
target=${servers[$RANDOM % ${#servers[@]}]}

echo "停止服务器 $target"
ssh user@$target 'sudo systemctl stop youngscoolplay-ui'

# 等待30秒
sleep 30

# 检查系统状态
curl -I http://192.168.1.12/

# 恢复服务器
echo "恢复服务器 $target"
ssh user@$target 'sudo systemctl start youngscoolplay-ui'
```

## 第四阶段：压力测试和性能优化

### 4.1 压力测试
**目标**: 确定系统性能极限

**测试工具**:
- Apache Bench (ab)
- wrk
- JMeter

**测试场景**:
```bash
# 基础压力测试
ab -n 10000 -c 100 http://192.168.1.12/

# 长时间压力测试
wrk -t12 -c400 -d30m http://192.168.1.12/

# 复杂场景测试
jmeter -n -t stress-test.jmx -l results.jtl
```

### 4.2 性能监控
**目标**: 实时监控系统性能指标

**监控指标**:
- CPU使用率
- 内存使用率
- 磁盘I/O
- 网络带宽
- 响应时间
- 错误率

**监控脚本**:
```bash
#!/bin/bash
# 性能监控脚本

while true; do
    echo "=== $(date) ==="
    
    # CPU和内存
    echo "CPU和内存使用率:"
    top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1
    free -h | grep "Mem:"
    
    # 网络连接
    echo "网络连接数:"
    netstat -an | grep :2053 | wc -l
    
    # 响应时间
    echo "响应时间:"
    curl -w "@curl-format.txt" -o /dev/null -s http://192.168.1.12/
    
    echo "---"
    sleep 10
done
```

### 4.3 性能优化
**目标**: 根据测试结果优化系统性能

**优化方向**:
1. **系统级优化**
   - 内核参数调优
   - 文件描述符限制
   - 网络缓冲区大小

2. **应用级优化**
   - 连接池配置
   - 缓存策略
   - 数据库优化

3. **负载均衡优化**
   - 算法选择
   - 健康检查频率
   - 超时设置

## 第五阶段：安全测试

### 5.1 访问控制测试
**目标**: 验证用户权限和访问控制

**测试项目**:
- 未授权访问测试
- 权限提升测试
- 会话管理测试
- 密码策略测试

### 5.2 网络安全测试
**目标**: 验证网络层安全性

**测试工具**:
- nmap
- nikto
- sqlmap

**测试命令**:
```bash
# 端口扫描
nmap -sS -O 192.168.1.10-12

# Web漏洞扫描
nikto -h http://192.168.1.12

# SSL/TLS测试
sslscan 192.168.1.12:443
```

### 5.3 数据安全测试
**目标**: 验证数据传输和存储安全

**测试内容**:
- 数据加密传输
- 敏感信息存储
- 日志安全性
- 备份恢复测试

## 第六阶段：用户体验测试

### 6.1 界面响应性测试
**目标**: 验证用户界面的响应性能

**测试指标**:
- 页面加载时间 < 3秒
- 操作响应时间 < 1秒
- 大数据量显示性能
- 移动端适配性

### 6.2 功能完整性测试
**目标**: 验证所有功能在多服务器环境下正常工作

**测试清单**:
- [ ] 用户管理功能
- [ ] 配置管理功能
- [ ] 监控统计功能
- [ ] 日志查看功能
- [ ] 系统设置功能
- [ ] 备份恢复功能

### 6.3 兼容性测试
**目标**: 验证不同浏览器和设备的兼容性

**测试环境**:
- Chrome (最新版本)
- Firefox (最新版本)
- Safari (最新版本)
- Edge (最新版本)
- 移动端浏览器

## 测试报告模板

### 测试执行记录
```
测试日期: ____
测试人员: ____
测试环境: ____
测试版本: ____

测试结果:
- 通过项目: __ / __
- 失败项目: __ / __
- 阻塞项目: __ / __

主要问题:
1. ________________
2. ________________
3. ________________

建议:
1. ________________
2. ________________
3. ________________
```

### 性能测试报告
```
测试配置:
- 并发用户数: ____
- 测试时长: ____
- 请求总数: ____

性能指标:
- 平均响应时间: ____ms
- 95%响应时间: ____ms
- 吞吐量: ____req/s
- 错误率: ____%

资源使用:
- CPU使用率: ____%
- 内存使用率: ____%
- 网络带宽: ____Mbps
```

## 测试自动化脚本

### 自动化测试框架
```bash
#!/bin/bash
# 自动化测试主脚本 - GitHub部署版本

TEST_DIR="/opt/youngscoolplay-test"
LOG_DIR="$TEST_DIR/logs"
REPORT_DIR="$TEST_DIR/reports"
REPO_URL="https://github.com/victoralwaysyoung/youngscoolplay-ui.git"

# 创建目录
mkdir -p $LOG_DIR $REPORT_DIR

echo "开始YoungsCoolPlay UI自动化测试 (GitHub部署版本)..."

# 环境检查
echo "检查测试环境..."
./check-environment.sh | tee $LOG_DIR/environment-check.log

# 第一阶段：单服务器测试 (GitHub部署)
echo "第一阶段：单服务器GitHub部署测试..."
./test-github-deployment.sh | tee $LOG_DIR/github-deployment.log

# 第二阶段：双服务器测试
echo "第二阶段：双服务器协同测试..."
./test-dual-server.sh | tee $LOG_DIR/dual-server.log

# 第三阶段：负载均衡测试
echo "第三阶段：负载均衡测试..."
./test-load-balance.sh | tee $LOG_DIR/load-balance.log

# 第四阶段：压力测试
echo "第四阶段：压力测试..."
./test-stress.sh | tee $LOG_DIR/stress.log

# 生成测试报告
echo "生成测试报告..."
./generate-report.sh

echo "测试完成，报告保存在 $REPORT_DIR"
```

### GitHub部署测试脚本
```bash
#!/bin/bash
# test-github-deployment.sh - GitHub部署专用测试脚本

REPO_URL="https://github.com/victoralwaysyoung/youngscoolplay-ui.git"
TEST_DIR="/opt/youngscoolplay-test"
INSTALL_DIR="/opt/youngscoolplay"

echo "=== GitHub部署测试开始 ==="

# 1. 环境检查
echo "1. 检查环境依赖..."
check_dependency() {
    local cmd=$1
    local name=$2
    if command -v $cmd >/dev/null 2>&1; then
        echo "✓ $name 已安装: $(command -v $cmd)"
        $cmd --version 2>/dev/null || $cmd version 2>/dev/null || echo "版本信息不可用"
    else
        echo "✗ $name 未安装"
        return 1
    fi
}

check_dependency git "Git"
check_dependency go "Go"
check_dependency curl "cURL"

# 2. 网络连接测试
echo "2. 测试GitHub连接..."
if ping -c 3 github.com >/dev/null 2>&1; then
    echo "✓ GitHub网络连接正常"
else
    echo "✗ GitHub网络连接失败"
    exit 1
fi

# 3. 源代码克隆测试
echo "3. 测试源代码克隆..."
if [ -d "$INSTALL_DIR" ]; then
    echo "清理现有目录..."
    sudo rm -rf $INSTALL_DIR
fi

cd /opt
if sudo git clone $REPO_URL youngscoolplay; then
    echo "✓ 源代码克隆成功"
    sudo chown -R $USER:$USER youngscoolplay
else
    echo "✗ 源代码克隆失败"
    exit 1
fi

# 4. 依赖下载测试
echo "4. 测试Go依赖下载..."
cd $INSTALL_DIR
if go mod tidy && go mod download; then
    echo "✓ Go依赖下载成功"
else
    echo "✗ Go依赖下载失败"
    exit 1
fi

# 5. 编译测试
echo "5. 测试项目编译..."
if CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -ldflags="-s -w" -o youngscoolplay-ui; then
    echo "✓ 项目编译成功"
    ls -lh youngscoolplay-ui
    file youngscoolplay-ui
else
    echo "✗ 项目编译失败"
    exit 1
fi

# 6. 安装测试
echo "6. 测试系统安装..."
# 创建系统用户 (如果不存在)
if ! id youngscoolplay >/dev/null 2>&1; then
    sudo useradd --system --shell /bin/false youngscoolplay
    echo "✓ 创建系统用户"
fi

# 创建目录
sudo mkdir -p /etc/youngscoolplay-ui
sudo mkdir -p /var/log/youngscoolplay-ui
sudo mkdir -p /var/lib/youngscoolplay-ui

# 复制文件
sudo cp youngscoolplay-ui /usr/local/bin/
sudo chmod +x /usr/local/bin/youngscoolplay-ui
sudo cp -r web /var/lib/youngscoolplay-ui/ 2>/dev/null || echo "Web目录复制跳过"
sudo cp -r bin /var/lib/youngscoolplay-ui/ 2>/dev/null || echo "Bin目录复制跳过"

echo "✓ 文件安装完成"

# 7. 配置文件测试
echo "7. 测试配置文件创建..."
sudo tee /etc/youngscoolplay-ui/config.json > /dev/null << 'EOF'
{
  "listen": "0.0.0.0",
  "port": 2053,
  "webBasePath": "/",
  "webPath": "/var/lib/youngscoolplay-ui/web",
  "sessionMaxAge": 60,
  "pageSize": 50,
  "timeLocation": "Asia/Shanghai"
}
EOF

echo "✓ 配置文件创建完成"

# 8. 服务文件测试
echo "8. 测试systemd服务配置..."
sudo tee /etc/systemd/system/youngscoolplay-ui.service > /dev/null << 'EOF'
[Unit]
Description=YoungsCoolPlay UI Service
After=network.target

[Service]
Type=simple
User=youngscoolplay
Group=youngscoolplay
ExecStart=/usr/local/bin/youngscoolplay-ui -config /etc/youngscoolplay-ui/config.json
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=multi-user.target
EOF

echo "✓ systemd服务文件创建完成"

# 9. 权限设置
echo "9. 设置文件权限..."
sudo chown -R youngscoolplay:youngscoolplay /etc/youngscoolplay-ui
sudo chown -R youngscoolplay:youngscoolplay /var/log/youngscoolplay-ui
sudo chown -R youngscoolplay:youngscoolplay /var/lib/youngscoolplay-ui

echo "✓ 权限设置完成"

# 10. 服务启动测试
echo "10. 测试服务启动..."
sudo systemctl daemon-reload
sudo systemctl enable youngscoolplay-ui

if sudo systemctl start youngscoolplay-ui; then
    echo "✓ 服务启动成功"
    sleep 3
    
    # 检查服务状态
    if sudo systemctl is-active youngscoolplay-ui >/dev/null; then
        echo "✓ 服务运行正常"
    else
        echo "✗ 服务启动后异常"
        sudo systemctl status youngscoolplay-ui
        exit 1
    fi
else
    echo "✗ 服务启动失败"
    sudo systemctl status youngscoolplay-ui
    exit 1
fi

# 11. 端口监听测试
echo "11. 测试端口监听..."
sleep 2
if sudo netstat -tuln | grep :2053 >/dev/null; then
    echo "✓ 端口2053监听正常"
else
    echo "✗ 端口2053未监听"
    exit 1
fi

# 12. Web访问测试
echo "12. 测试Web访问..."
if curl -s -I http://localhost:2053 | grep -q "HTTP"; then
    echo "✓ Web访问正常"
else
    echo "✗ Web访问失败"
    exit 1
fi

echo "=== GitHub部署测试完成 ==="
echo "所有测试项目通过！"
```

### 环境检查脚本
```bash
#!/bin/bash
# check-environment.sh - 环境检查脚本

echo "=== 环境检查开始 ==="

# 检查操作系统
echo "1. 操作系统信息:"
lsb_release -a 2>/dev/null || cat /etc/os-release

# 检查系统资源
echo "2. 系统资源:"
echo "CPU: $(nproc) cores"
echo "内存: $(free -h | grep Mem | awk '{print $2}')"
echo "磁盘: $(df -h / | tail -1 | awk '{print $4}') 可用"

# 检查网络
echo "3. 网络连接:"
ping -c 1 8.8.8.8 >/dev/null && echo "✓ 互联网连接正常" || echo "✗ 互联网连接异常"
ping -c 1 github.com >/dev/null && echo "✓ GitHub连接正常" || echo "✗ GitHub连接异常"

# 检查必要软件
echo "4. 必要软件检查:"
for cmd in git go curl wget unzip; do
    if command -v $cmd >/dev/null; then
        echo "✓ $cmd: $(command -v $cmd)"
    else
        echo "✗ $cmd: 未安装"
    fi
done

# 检查Go版本
if command -v go >/dev/null; then
    GO_VERSION=$(go version | awk '{print $3}' | sed 's/go//')
    echo "Go版本: $GO_VERSION"
    
    # 检查版本是否满足要求 (>= 1.21)
    if [ "$(printf '%s\n' "1.21" "$GO_VERSION" | sort -V | head -n1)" = "1.21" ]; then
        echo "✓ Go版本满足要求"
    else
        echo "✗ Go版本过低，需要 >= 1.21"
    fi
fi

echo "=== 环境检查完成 ==="
```

## 总结

本测试计划涵盖了YoungsCoolPlay UI在三服务器环境下的全面测试，**采用GitHub远程拉取源代码并编译部署的方式**，包括功能测试、性能测试、安全测试和用户体验测试。

### 主要特点

1. **GitHub源代码部署**: 通过git clone从GitHub获取最新源代码，确保部署版本的一致性和可追溯性
2. **自动化编译**: 使用Go编译器直接在目标服务器上编译，避免跨平台兼容性问题
3. **环境依赖检查**: 完整的环境检查脚本，确保服务器具备必要的运行环境
4. **系统化测试**: 从单服务器到多服务器，从功能到性能的全面测试覆盖

### 部署优势

- **版本控制**: 可以轻松切换到任意Git分支或标签版本
- **实时更新**: 支持通过git pull获取最新代码更新
- **环境一致性**: 在目标环境直接编译，确保运行环境一致性
- **可追溯性**: 每次部署都有明确的Git提交记录

### 测试流程

1. **环境准备**: 安装Git、Go等必要工具，配置GitHub访问
2. **源代码获取**: 从GitHub克隆项目源代码
3. **依赖管理**: 下载和验证Go模块依赖
4. **编译部署**: 编译生成可执行文件并安装到系统
5. **服务配置**: 创建systemd服务和配置文件
6. **功能测试**: 验证各项功能正常工作
7. **性能测试**: 评估系统性能指标
8. **高可用测试**: 测试多服务器协同和故障切换

### 使用建议

1. **网络要求**: 确保服务器能够正常访问GitHub
2. **权限管理**: 使用专用系统用户运行服务，提高安全性
3. **监控告警**: 配置适当的监控和日志记录
4. **备份策略**: 定期备份配置文件和重要数据
5. **更新策略**: 建立规范的代码更新和部署流程

通过系统性的测试，可以确保YoungsCoolPlay UI在生产环境中的稳定性、可靠性和高可用性。测试过程中发现的问题应及时记录并跟踪解决，确保系统质量达到生产要求。

### 快速开始

```bash
# 1. 环境检查
./check-environment.sh

# 2. GitHub部署测试
./test-github-deployment.sh

# 3. 完整测试套件
./auto-test-main.sh
```

**注意**: 脚本中已配置实际的GitHub仓库地址 `https://github.com/victoralwaysyoung/youngscoolplay-ui.git`。